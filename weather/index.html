
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Ç—Ä–µ–∫–µ—Ä –ø–æ–≥–æ–¥—ã</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4285f4;
      --secondary: #34a853;
      --danger: #ea4335;
      --light: #f8f9fa;
      --dark: #202124;
    }
    :root[data-theme='dark'] {
      --primary: #8ab4f8;
      --secondary: #81c995;
      --danger: #f28b82;
      --light: #202124;
      --dark: #e8eaed;
      background-color: #121212;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Roboto', sans-serif;
      line-height: 1.6;
      color: var(--dark);
      background-color: var(--light);
      padding: 15px;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    header {
      display: flex; flex-direction: column; gap: 10px;
      margin-bottom: 20px; padding-bottom: 15px;
      border-bottom: 1px solid #ddd;
    }
    h1 { color: var(--primary); font-size: 24px; text-align: center; }
    input, button, select {
      padding: 10px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;
    }
    button { background: var(--primary); color: white; border: none; cursor: pointer; }
    button:hover { background: #3367d6; }
    button.secondary { background: var(--secondary); }
    .search-container { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
    input { flex: 1; min-width: 200px; }
    .current-weather, .forecast, .hourly-forecast {
      background: var(--light); border-radius: 8px; padding: 20px;
      margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .hourly-list {
      display: flex;
      overflow-x: auto;
      gap: 15px;
      margin-top: 20px;
      padding-bottom: 10px;
    }
    .hourly-item {
      min-width: 100px;
      text-align: center;
      padding: 10px;
      background: var(--light);
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .forecast-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .forecast-item {
      text-align: center;
      padding: 15px;
      background: var(--light);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .forecast-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
    }
    .forecast-day {
      font-weight: 500;
      font-size: 18px;
      margin-bottom: 5px;
      color: var(--primary);
    }
    .forecast-date {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
    }
    .forecast-temp {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
      font-size: 18px;
    }
    .forecast-temp .high {
      font-weight: 500;
      color: var(--danger);
    }
    .forecast-temp .low {
      color: var(--primary);
    }
    .forecast-details {
      margin-top: 10px;
      text-align: center;
      font-size: 14px;
      line-height: 1.6;
      width: 100%;
    }
    .forecast-details div {
      padding: 4px 0;
      border-top: 1px solid #eee;
    }
    .weather-icon {
      width: 50px;
      height: 50px;
      margin: 5px 0;
    }
    .favorites-list { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .favorite-item {
      background-color: white; padding: 8px 15px; border-radius: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer;
    }
    footer {
      text-align: center; margin-top: 40px; padding: 20px 0; color: #666;
      font-size: 14px; border-top: 1px solid #eee;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Ç—Ä–µ–∫–µ—Ä –ø–æ–≥–æ–¥—ã</h1>
      <div>
        <select id="unit-select">
          <option value="metric">¬∞C, –º/—Å</option>
          <option value="imperial">¬∞F, –º–∏–ª—å/—á</option>
        </select>
      </div>
    </header>
    <div class="search-container">
      <input type="text" id="city-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥">
      <button id="search-btn">–ü–æ–∏—Å–∫</button>
      <button id="geo-btn">üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
      <button id="add-favorite-btn" class="secondary">‚òÖ –î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
    <div class="current-weather">
      <h2 id="current-city">–ì–æ—Ä–æ–¥</h2>
      <div id="current-date">–î–∞—Ç–∞</div>
      <div id="current-temp">0¬∞C</div>
      <img id="current-weather-icon" src="" alt="–ü–æ–≥–æ–¥–∞">
      <div id="current-description"></div>
      <div id="current-feels-like"></div>
      <div id="humidity"></div>
      <div id="wind"></div>
      <div id="pressure"></div>
      <div id="visibility"></div>
    </div>
    <div class="hourly-forecast">
      <h3>–ü–æ—á–∞—Å–æ–≤–æ–π –ø—Ä–æ–≥–Ω–æ–∑</h3>
      <div class="hourly-list" id="hourly-container"></div>
    </div>
    <div class="forecast">
      <h3>–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 5 –¥–Ω–µ–π</h3>
      <div class="forecast-list" id="forecast-container"></div>
    </div>
    <div class="favorites">
      <h3>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –≥–æ—Ä–æ–¥–∞</h3>
      <div class="favorites-list" id="favorites-container"></div>
    </div>
    <footer>–≥. –°—É–º—ã, (–≤–µ—Ä—Å–∏—è 1.2) ¬© 2025</footer>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const apiKey = atob("MzEyOTMxMDEwYWZhNWQ3OGI4N2I0MzY4NGRjYmMyYTA=");
      let currentCity = localStorage.getItem('lastCity') || '–°—É–º—ã';
      let units = 'metric';
      let favorites = JSON.parse(localStorage.getItem('weatherFavorites')) || [];
      const cityInput = document.getElementById('city-input');
      const forecastContainer = document.getElementById('forecast-container');
      const hourlyContainer = document.getElementById('hourly-container');

      const currentCityElement = document.getElementById('current-city');
      const currentDateElement = document.getElementById('current-date');
      const currentTempElement = document.getElementById('current-temp');
      const currentWeatherIcon = document.getElementById('current-weather-icon');
      const currentDescription = document.getElementById('current-description');
      const currentFeelsLike = document.getElementById('current-feels-like');
      const humidityElement = document.getElementById('humidity');
      const windElement = document.getElementById('wind');
      const pressureElement = document.getElementById('pressure');
      const visibilityElement = document.getElementById('visibility');

      function getUnitSymbol() {
        return units === 'metric' ? '¬∞C' : '¬∞F';
      }

      async function getWeather(city) {
        localStorage.setItem('lastCity', city);
        const resp1 = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=${units}&appid=${apiKey}&lang=ru`);
        const data1 = await resp1.json();
        displayCurrentWeather(data1);

        const resp2 = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=${units}&appid=${apiKey}&lang=ru`);
        const data2 = await resp2.json();
        displayHourlyForecast(data2);
        displayForecast(data2);
      }

      function displayCurrentWeather(data) {
        currentCityElement.textContent = `${data.name}, ${data.sys.country}`;
        currentDateElement.textContent = new Date().toLocaleString('ru-RU');
        currentTempElement.textContent = `${Math.round(data.main.temp)}${getUnitSymbol()}`;
        currentFeelsLike.textContent = `–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫: ${Math.round(data.main.feels_like)}${getUnitSymbol()}`;
        currentWeatherIcon.src = `https://openweathermap.org/img/wn/${data.weather[0].icon}.png`;
        currentWeatherIcon.alt = data.weather[0].description;
        currentDescription.textContent = data.weather[0].description;
        humidityElement.textContent = `–í–ª–∞–∂–Ω–æ—Å—Ç—å: ${data.main.humidity}%`;
        windElement.textContent = `–í–µ—Ç–µ—Ä: ${data.wind.speed} ${units === 'metric' ? '–º/—Å' : '–º–∏–ª—å/—á'}`;
        pressureElement.textContent = `–î–∞–≤–ª–µ–Ω–∏–µ: ${data.main.pressure} hPa`;
        visibilityElement.textContent = `–í–∏–¥–∏–º–æ—Å—Ç—å: ${data.visibility / 1000} –∫–º`;
      }

      function displayHourlyForecast(data) {
        hourlyContainer.innerHTML = '';
        const hourlyData = data.list.slice(0, 8);
        
        hourlyData.forEach(item => {
          const date = new Date(item.dt * 1000);
          const time = date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
          const temp = Math.round(item.main.temp);
          const icon = item.weather[0].icon;
          const desc = item.weather[0].description;
          const feels = Math.round(item.main.feels_like);
          const wind = item.wind.speed.toFixed(1);
          const humidity = item.main.humidity;

          const itemElement = document.createElement('div');
          itemElement.className = 'hourly-item';
          itemElement.innerHTML = `
            <div>${time}</div>
            <img src="https://openweathermap.org/img/wn/${icon}.png" alt="${desc}">
            <div>${temp}${getUnitSymbol()}</div>
            <div style="font-size:12px;margin-top:5px;">–û—â—É—â–∞–µ—Ç—Å—è: ${feels}${getUnitSymbol()}</div>
            <div style="font-size:12px">–í–µ—Ç–µ—Ä: ${wind} ${units === 'metric' ? '–º/—Å' : '–º–∏–ª—å/—á'}</div>
            <div style="font-size:12px">–í–ª–∞–∂–Ω–æ—Å—Ç—å: ${humidity}%</div>
          `;
          hourlyContainer.appendChild(itemElement);
        });
      }

      function displayForecast(data) {
        forecastContainer.innerHTML = '';
        const daily = {};
        data.list.forEach(item => {
          const date = new Date(item.dt * 1000);
          const key = date.toLocaleDateString('ru-RU');
          if (!daily[key]) daily[key] = { date, temps: [], feels: [], icons: [], descriptions: [], humidity: [], wind: [], pressure: [] };
          daily[key].temps.push(item.main.temp);
          daily[key].feels.push(item.main.feels_like);
          daily[key].icons.push(item.weather[0].icon);
          daily[key].descriptions.push(item.weather[0].description);
          daily[key].humidity.push(item.main.humidity);
          daily[key].wind.push(item.wind.speed);
          daily[key].pressure.push(item.main.pressure);
        });
        
        Object.values(daily).slice(0, 5).forEach((d, i) => {
          const max = Math.round(Math.max(...d.temps));
          const min = Math.round(Math.min(...d.temps));
          const feels = Math.round(d.feels.reduce((a, b) => a + b, 0) / d.feels.length);
          const hum = Math.round(d.humidity.reduce((a, b) => a + b, 0) / d.humidity.length);
          const wind = (d.wind.reduce((a, b) => a + b, 0) / d.wind.length).toFixed(1);
          const pres = Math.round(d.pressure.reduce((a, b) => a + b, 0) / d.pressure.length);
          const icon = d.icons.sort((a, b) => d.icons.filter(v => v === b).length - d.icons.filter(v => v === a).length)[0];
          const desc = d.descriptions[0];
          const dayName = i === 0 ? '–°–µ–≥–æ–¥–Ω—è' : i === 1 ? '–ó–∞–≤—Ç—Ä–∞' : d.date.toLocaleDateString('ru-RU', { weekday: 'long' });

          const item = document.createElement('div');
          item.className = 'forecast-item';
          item.innerHTML = `
            <div class="forecast-day">${dayName}</div>
            <div class="forecast-date">${d.date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' })}</div>
            <img class="weather-icon" src="https://openweathermap.org/img/wn/${icon}.png" alt="${desc}">
            <div class="forecast-temp">
              <span class="high">${max}${getUnitSymbol()}</span>
              <span class="low">${min}${getUnitSymbol()}</span>
            </div>
            <div class="forecast-details">
              <div>${desc}</div>
              <div>–û—â—É—â–∞–µ—Ç—Å—è: ${feels}${getUnitSymbol()}</div>
              <div>–í–ª–∞–∂–Ω–æ—Å—Ç—å: ${hum}%</div>
              <div>–í–µ—Ç–µ—Ä: ${wind} ${units === 'metric' ? '–º/—Å' : '–º–∏–ª—å/—á'}</div>
              <div>–î–∞–≤–ª–µ–Ω–∏–µ: ${pres} hPa</div>
            </div>
          `;
          forecastContainer.appendChild(item);
        });
      }

      document.getElementById('search-btn').onclick = () => {
        const city = cityInput.value.trim();
        if (city) getWeather(city);
      };
      document.getElementById('unit-select').onchange = e => {
        units = e.target.value;
        getWeather(currentCity);
      };
      document.getElementById('geo-btn').onclick = () => {
        navigator.geolocation.getCurrentPosition(pos => {
          const { latitude, longitude } = pos.coords;
          fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&units=${units}&appid=${apiKey}&lang=ru`)
            .then(r => r.json()).then(d => getWeather(d.name));
        });
      };
      document.getElementById('add-favorite-btn').onclick = () => {
        if (currentCity && !favorites.includes(currentCity)) {
          favorites.push(currentCity);
          localStorage.setItem('weatherFavorites', JSON.stringify(favorites));
          alert('–ì–æ—Ä–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
        }
      };
      const themeBtn = document.createElement('button');
      themeBtn.textContent = 'üåì –¢–µ–º–∞';
      themeBtn.onclick = () => {
        const d = document.documentElement;
        const isDark = d.getAttribute('data-theme') === 'dark';
        d.setAttribute('data-theme', isDark ? '' : 'dark');
        localStorage.setItem('theme', isDark ? 'light' : 'dark');
      };
      document.querySelector('header').appendChild(themeBtn);
      if (localStorage.getItem('theme') === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
      }
      getWeather(currentCity);
    });
  </script>
</body>
</html>
